<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>模拟 Vite | Study Notes</title>
  <meta name="generator" content="VuePress 1.5.2">
  <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement('script');
      hm.src = 'https://hm.baidu.com/hm.js?408fc8ae9e93287c6ac296cfac03abf8';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  
  <meta name="description" content="大前端学习笔记">
    <meta name="keywords" content="Study Notes,Wuner,Vue,前端学习笔记,函数式编程,Promise,ES6+,TypeScript,JS性能优化,cli,脚手架,自动化构建,yeoman,plop,gulp,grunt,ESModule,webpack,rollup,lint,vue-router,vue-observe,virtual-dom,虚拟dom,vue源码解析,vue响应式原理,vue虚拟dom,vue模板编译,vue组件化,vue状态管理(vuex),服务端渲染(ssr),nuxtJs,搭建SSR">
  <link rel="preload" href="/wuner-notes/assets/css/0.styles.c6185683.css" as="style"><link rel="preload" href="/wuner-notes/assets/js/app.a809ef8d.js" as="script"><link rel="preload" href="/wuner-notes/assets/js/3.aefe3dc3.js" as="script"><link rel="preload" href="/wuner-notes/assets/js/6.50a8d784.js" as="script"><link rel="prefetch" href="/wuner-notes/assets/js/10.7976e91f.js"><link rel="prefetch" href="/wuner-notes/assets/js/100.83923d25.js"><link rel="prefetch" href="/wuner-notes/assets/js/101.a6e0c361.js"><link rel="prefetch" href="/wuner-notes/assets/js/102.0beac992.js"><link rel="prefetch" href="/wuner-notes/assets/js/103.16658d3e.js"><link rel="prefetch" href="/wuner-notes/assets/js/104.229f702d.js"><link rel="prefetch" href="/wuner-notes/assets/js/105.7603531e.js"><link rel="prefetch" href="/wuner-notes/assets/js/106.c6cf5520.js"><link rel="prefetch" href="/wuner-notes/assets/js/107.2ba933e2.js"><link rel="prefetch" href="/wuner-notes/assets/js/108.496ff2cc.js"><link rel="prefetch" href="/wuner-notes/assets/js/109.ca18a9f1.js"><link rel="prefetch" href="/wuner-notes/assets/js/11.589a46d9.js"><link rel="prefetch" href="/wuner-notes/assets/js/110.2b88f986.js"><link rel="prefetch" href="/wuner-notes/assets/js/111.dd51c5d3.js"><link rel="prefetch" href="/wuner-notes/assets/js/112.cb8f456b.js"><link rel="prefetch" href="/wuner-notes/assets/js/113.58fcd0cb.js"><link rel="prefetch" href="/wuner-notes/assets/js/114.417e806c.js"><link rel="prefetch" href="/wuner-notes/assets/js/115.9a08e21a.js"><link rel="prefetch" href="/wuner-notes/assets/js/116.5d825eec.js"><link rel="prefetch" href="/wuner-notes/assets/js/117.38ea656b.js"><link rel="prefetch" href="/wuner-notes/assets/js/118.87c529e3.js"><link rel="prefetch" href="/wuner-notes/assets/js/119.cdfe8073.js"><link rel="prefetch" href="/wuner-notes/assets/js/12.9624a54d.js"><link rel="prefetch" href="/wuner-notes/assets/js/120.0d746ec4.js"><link rel="prefetch" href="/wuner-notes/assets/js/121.e7060a35.js"><link rel="prefetch" href="/wuner-notes/assets/js/122.e996cc4d.js"><link rel="prefetch" href="/wuner-notes/assets/js/123.b36e6eda.js"><link rel="prefetch" href="/wuner-notes/assets/js/124.d9aeb609.js"><link rel="prefetch" href="/wuner-notes/assets/js/125.6defae1b.js"><link rel="prefetch" href="/wuner-notes/assets/js/126.abe18c38.js"><link rel="prefetch" href="/wuner-notes/assets/js/127.47e4c3b2.js"><link rel="prefetch" href="/wuner-notes/assets/js/128.e254e598.js"><link rel="prefetch" href="/wuner-notes/assets/js/129.4ed94512.js"><link rel="prefetch" href="/wuner-notes/assets/js/13.b0ee3a30.js"><link rel="prefetch" href="/wuner-notes/assets/js/130.b3464e80.js"><link rel="prefetch" href="/wuner-notes/assets/js/131.2bce54d8.js"><link rel="prefetch" href="/wuner-notes/assets/js/132.b0bfb318.js"><link rel="prefetch" href="/wuner-notes/assets/js/133.cb916b45.js"><link rel="prefetch" href="/wuner-notes/assets/js/134.7d5ddb19.js"><link rel="prefetch" href="/wuner-notes/assets/js/135.6a00dc80.js"><link rel="prefetch" href="/wuner-notes/assets/js/136.c2ea2fc5.js"><link rel="prefetch" href="/wuner-notes/assets/js/137.171fb43e.js"><link rel="prefetch" href="/wuner-notes/assets/js/138.786f6a60.js"><link rel="prefetch" href="/wuner-notes/assets/js/139.7ae403b4.js"><link rel="prefetch" href="/wuner-notes/assets/js/14.1af6ecbe.js"><link rel="prefetch" href="/wuner-notes/assets/js/140.954d2ef0.js"><link rel="prefetch" href="/wuner-notes/assets/js/141.cd3408c4.js"><link rel="prefetch" href="/wuner-notes/assets/js/142.ad396f45.js"><link rel="prefetch" href="/wuner-notes/assets/js/143.ab063f89.js"><link rel="prefetch" href="/wuner-notes/assets/js/144.856bcd6a.js"><link rel="prefetch" href="/wuner-notes/assets/js/145.19bfaf21.js"><link rel="prefetch" href="/wuner-notes/assets/js/146.b6678f3d.js"><link rel="prefetch" href="/wuner-notes/assets/js/147.da39d200.js"><link rel="prefetch" href="/wuner-notes/assets/js/148.981b6bc2.js"><link rel="prefetch" href="/wuner-notes/assets/js/149.1337b9fe.js"><link rel="prefetch" href="/wuner-notes/assets/js/15.3c8f9d88.js"><link rel="prefetch" href="/wuner-notes/assets/js/150.999602c2.js"><link rel="prefetch" href="/wuner-notes/assets/js/151.572bccdb.js"><link rel="prefetch" href="/wuner-notes/assets/js/152.0e7ed536.js"><link rel="prefetch" href="/wuner-notes/assets/js/153.fc7aeac7.js"><link rel="prefetch" href="/wuner-notes/assets/js/154.876cdbb3.js"><link rel="prefetch" href="/wuner-notes/assets/js/155.9dfa71b1.js"><link rel="prefetch" href="/wuner-notes/assets/js/156.fa741ec7.js"><link rel="prefetch" href="/wuner-notes/assets/js/157.b1dcaaaa.js"><link rel="prefetch" href="/wuner-notes/assets/js/158.4f490352.js"><link rel="prefetch" href="/wuner-notes/assets/js/159.7dd29e40.js"><link rel="prefetch" href="/wuner-notes/assets/js/16.ab5dc4e7.js"><link rel="prefetch" href="/wuner-notes/assets/js/160.a4f90644.js"><link rel="prefetch" href="/wuner-notes/assets/js/161.794517fd.js"><link rel="prefetch" href="/wuner-notes/assets/js/162.d0347e26.js"><link rel="prefetch" href="/wuner-notes/assets/js/163.f502d3d1.js"><link rel="prefetch" href="/wuner-notes/assets/js/164.113359c3.js"><link rel="prefetch" href="/wuner-notes/assets/js/165.a7822bda.js"><link rel="prefetch" href="/wuner-notes/assets/js/166.8f815d80.js"><link rel="prefetch" href="/wuner-notes/assets/js/167.61e24439.js"><link rel="prefetch" href="/wuner-notes/assets/js/168.1bb14bf5.js"><link rel="prefetch" href="/wuner-notes/assets/js/169.e687b540.js"><link rel="prefetch" href="/wuner-notes/assets/js/17.c3e4c1f9.js"><link rel="prefetch" href="/wuner-notes/assets/js/170.07a4d5fe.js"><link rel="prefetch" href="/wuner-notes/assets/js/171.0e91ed26.js"><link rel="prefetch" href="/wuner-notes/assets/js/172.41d0a29d.js"><link rel="prefetch" href="/wuner-notes/assets/js/173.475948b8.js"><link rel="prefetch" href="/wuner-notes/assets/js/174.4c10b74e.js"><link rel="prefetch" href="/wuner-notes/assets/js/175.84aff17f.js"><link rel="prefetch" href="/wuner-notes/assets/js/176.2ee0965b.js"><link rel="prefetch" href="/wuner-notes/assets/js/177.8cdb75b7.js"><link rel="prefetch" href="/wuner-notes/assets/js/178.91477146.js"><link rel="prefetch" href="/wuner-notes/assets/js/179.7752a28c.js"><link rel="prefetch" href="/wuner-notes/assets/js/18.edfeea1b.js"><link rel="prefetch" href="/wuner-notes/assets/js/180.89909185.js"><link rel="prefetch" href="/wuner-notes/assets/js/181.add38058.js"><link rel="prefetch" href="/wuner-notes/assets/js/182.0bf95f16.js"><link rel="prefetch" href="/wuner-notes/assets/js/183.ff153ecc.js"><link rel="prefetch" href="/wuner-notes/assets/js/184.17b3918d.js"><link rel="prefetch" href="/wuner-notes/assets/js/185.962d670d.js"><link rel="prefetch" href="/wuner-notes/assets/js/186.d6910993.js"><link rel="prefetch" href="/wuner-notes/assets/js/187.8a5ada85.js"><link rel="prefetch" href="/wuner-notes/assets/js/188.46b5e769.js"><link rel="prefetch" href="/wuner-notes/assets/js/189.82f44dd5.js"><link rel="prefetch" href="/wuner-notes/assets/js/19.9cc2a7b5.js"><link rel="prefetch" href="/wuner-notes/assets/js/190.6cc8372f.js"><link rel="prefetch" href="/wuner-notes/assets/js/191.a33bd656.js"><link rel="prefetch" href="/wuner-notes/assets/js/192.7a2d0346.js"><link rel="prefetch" href="/wuner-notes/assets/js/193.f6d1ebba.js"><link rel="prefetch" href="/wuner-notes/assets/js/194.3408c045.js"><link rel="prefetch" href="/wuner-notes/assets/js/195.ca57f871.js"><link rel="prefetch" href="/wuner-notes/assets/js/196.2f778353.js"><link rel="prefetch" href="/wuner-notes/assets/js/197.b89f9012.js"><link rel="prefetch" href="/wuner-notes/assets/js/198.6d10dc84.js"><link rel="prefetch" href="/wuner-notes/assets/js/20.f52d8f50.js"><link rel="prefetch" href="/wuner-notes/assets/js/21.181487df.js"><link rel="prefetch" href="/wuner-notes/assets/js/22.7e731743.js"><link rel="prefetch" href="/wuner-notes/assets/js/23.67776d25.js"><link rel="prefetch" href="/wuner-notes/assets/js/24.952f3da8.js"><link rel="prefetch" href="/wuner-notes/assets/js/25.041f0768.js"><link rel="prefetch" href="/wuner-notes/assets/js/26.a8936c58.js"><link rel="prefetch" href="/wuner-notes/assets/js/27.f75ebb6c.js"><link rel="prefetch" href="/wuner-notes/assets/js/28.0c8492a7.js"><link rel="prefetch" href="/wuner-notes/assets/js/29.a1c74893.js"><link rel="prefetch" href="/wuner-notes/assets/js/30.fd3b777a.js"><link rel="prefetch" href="/wuner-notes/assets/js/31.67cbb794.js"><link rel="prefetch" href="/wuner-notes/assets/js/32.281f8859.js"><link rel="prefetch" href="/wuner-notes/assets/js/33.0b9aa40c.js"><link rel="prefetch" href="/wuner-notes/assets/js/34.af735477.js"><link rel="prefetch" href="/wuner-notes/assets/js/35.8bf0fd87.js"><link rel="prefetch" href="/wuner-notes/assets/js/36.4630365c.js"><link rel="prefetch" href="/wuner-notes/assets/js/37.99381559.js"><link rel="prefetch" href="/wuner-notes/assets/js/38.803f8518.js"><link rel="prefetch" href="/wuner-notes/assets/js/39.0594b31e.js"><link rel="prefetch" href="/wuner-notes/assets/js/4.6d605efe.js"><link rel="prefetch" href="/wuner-notes/assets/js/40.2c974435.js"><link rel="prefetch" href="/wuner-notes/assets/js/41.152b0e60.js"><link rel="prefetch" href="/wuner-notes/assets/js/42.fa640ede.js"><link rel="prefetch" href="/wuner-notes/assets/js/43.d2e99ad9.js"><link rel="prefetch" href="/wuner-notes/assets/js/44.912850e7.js"><link rel="prefetch" href="/wuner-notes/assets/js/45.af340e8d.js"><link rel="prefetch" href="/wuner-notes/assets/js/46.2c893977.js"><link rel="prefetch" href="/wuner-notes/assets/js/47.17265f1a.js"><link rel="prefetch" href="/wuner-notes/assets/js/48.372cf11b.js"><link rel="prefetch" href="/wuner-notes/assets/js/49.ef1de019.js"><link rel="prefetch" href="/wuner-notes/assets/js/5.499729e8.js"><link rel="prefetch" href="/wuner-notes/assets/js/50.9fc862de.js"><link rel="prefetch" href="/wuner-notes/assets/js/51.9e3df210.js"><link rel="prefetch" href="/wuner-notes/assets/js/52.da2225f6.js"><link rel="prefetch" href="/wuner-notes/assets/js/53.d9f34217.js"><link rel="prefetch" href="/wuner-notes/assets/js/54.77a9fff9.js"><link rel="prefetch" href="/wuner-notes/assets/js/55.e606317e.js"><link rel="prefetch" href="/wuner-notes/assets/js/56.02bce45f.js"><link rel="prefetch" href="/wuner-notes/assets/js/57.6ad0ff97.js"><link rel="prefetch" href="/wuner-notes/assets/js/58.cd8e403d.js"><link rel="prefetch" href="/wuner-notes/assets/js/59.ddb0aa03.js"><link rel="prefetch" href="/wuner-notes/assets/js/60.f1a2db78.js"><link rel="prefetch" href="/wuner-notes/assets/js/61.7b9056be.js"><link rel="prefetch" href="/wuner-notes/assets/js/62.cad0ce41.js"><link rel="prefetch" href="/wuner-notes/assets/js/63.76522648.js"><link rel="prefetch" href="/wuner-notes/assets/js/64.6c93bdcb.js"><link rel="prefetch" href="/wuner-notes/assets/js/65.71b0fd1a.js"><link rel="prefetch" href="/wuner-notes/assets/js/66.898de639.js"><link rel="prefetch" href="/wuner-notes/assets/js/67.f2ef50b9.js"><link rel="prefetch" href="/wuner-notes/assets/js/68.9fb2e4f9.js"><link rel="prefetch" href="/wuner-notes/assets/js/69.1443e812.js"><link rel="prefetch" href="/wuner-notes/assets/js/7.5d593870.js"><link rel="prefetch" href="/wuner-notes/assets/js/70.8383b983.js"><link rel="prefetch" href="/wuner-notes/assets/js/71.634c9345.js"><link rel="prefetch" href="/wuner-notes/assets/js/72.507e6f87.js"><link rel="prefetch" href="/wuner-notes/assets/js/73.807954f0.js"><link rel="prefetch" href="/wuner-notes/assets/js/74.9c23de88.js"><link rel="prefetch" href="/wuner-notes/assets/js/75.97c3d5e0.js"><link rel="prefetch" href="/wuner-notes/assets/js/76.201de7ca.js"><link rel="prefetch" href="/wuner-notes/assets/js/77.2c7ed4a5.js"><link rel="prefetch" href="/wuner-notes/assets/js/78.b08060f6.js"><link rel="prefetch" href="/wuner-notes/assets/js/79.068f88a5.js"><link rel="prefetch" href="/wuner-notes/assets/js/8.7e45c9f6.js"><link rel="prefetch" href="/wuner-notes/assets/js/80.67e71c37.js"><link rel="prefetch" href="/wuner-notes/assets/js/81.453ffa1d.js"><link rel="prefetch" href="/wuner-notes/assets/js/82.19d9b23e.js"><link rel="prefetch" href="/wuner-notes/assets/js/83.e28951a8.js"><link rel="prefetch" href="/wuner-notes/assets/js/84.acf83fd2.js"><link rel="prefetch" href="/wuner-notes/assets/js/85.a148175c.js"><link rel="prefetch" href="/wuner-notes/assets/js/86.29b224ad.js"><link rel="prefetch" href="/wuner-notes/assets/js/87.d0a3a990.js"><link rel="prefetch" href="/wuner-notes/assets/js/88.6dc2007c.js"><link rel="prefetch" href="/wuner-notes/assets/js/89.dce4546d.js"><link rel="prefetch" href="/wuner-notes/assets/js/9.dd4046db.js"><link rel="prefetch" href="/wuner-notes/assets/js/90.95e77eb4.js"><link rel="prefetch" href="/wuner-notes/assets/js/91.1c2421b2.js"><link rel="prefetch" href="/wuner-notes/assets/js/92.3a81c211.js"><link rel="prefetch" href="/wuner-notes/assets/js/93.5f6d6263.js"><link rel="prefetch" href="/wuner-notes/assets/js/94.8a9faaa2.js"><link rel="prefetch" href="/wuner-notes/assets/js/95.483f58d5.js"><link rel="prefetch" href="/wuner-notes/assets/js/96.e1fa253e.js"><link rel="prefetch" href="/wuner-notes/assets/js/97.4ee07616.js"><link rel="prefetch" href="/wuner-notes/assets/js/98.6728a5ee.js"><link rel="prefetch" href="/wuner-notes/assets/js/99.34ed8e76.js"><link rel="prefetch" href="/wuner-notes/assets/js/vendors~docsearch.529fd6da.js">
  <link rel="stylesheet" href="/wuner-notes/assets/css/0.styles.c6185683.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wuner-notes/" class="home-link router-link-active"><!----> <span class="site-name">Study Notes</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://blog.csdn.net/qq_32090185" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/notes/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/notes/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/notes/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/notes/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/notes/" class="nav-link">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/notes/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/notes/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/notes/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/notes/" class="nav-link router-link-active">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/notes/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="题目" class="dropdown-title"><span class="title">题目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/" class="nav-link">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/" class="nav-link router-link-active">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><a href="/wuner-notes/interview-questions/w-001-js-base/" class="nav-link">
  面试题
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://blog.csdn.net/qq_32090185" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/notes/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/notes/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/notes/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/notes/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/notes/" class="nav-link">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/notes/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/notes/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/notes/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/notes/" class="nav-link router-link-active">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/notes/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="题目" class="dropdown-title"><span class="title">题目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/" class="nav-link">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/" class="nav-link router-link-active">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><a href="/wuner-notes/interview-questions/w-001-js-base/" class="nav-link">
  面试题
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/wuner-notes/fed-e-task-03-05/notes/" aria-current="page" class="sidebar-link">Vue.js 3.x Composition APIs 及 3.x 原理剖析</a></li><li><a href="/wuner-notes/fed-e-task-03-05/notes/w-001-vue3.x-Introduction/" class="sidebar-link">Vue 3.x 介绍</a></li><li><a href="/wuner-notes/fed-e-task-03-05/notes/w-002-composition-api/" class="sidebar-link">Composition API</a></li><li><a href="/wuner-notes/fed-e-task-03-05/notes/w-003-to-do-list/" class="sidebar-link">Vue3.x Composition API - ToDoList 案例</a></li><li><a href="/wuner-notes/fed-e-task-03-05/notes/w-004-reactivity/" class="sidebar-link">Vue.js 3.x 响应式系统原理</a></li><li><a href="/wuner-notes/fed-e-task-03-05/notes/w-005-vite/" class="sidebar-link">Vite</a></li><li><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/" aria-current="page" class="active sidebar-link">模拟 Vite</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#vite-核心功能" class="sidebar-link">Vite 核心功能</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#vite-工作步骤" class="sidebar-link">Vite 工作步骤</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#创建-vue3-x-项目" class="sidebar-link">创建 Vue3.x 项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#npm" class="sidebar-link">npm</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#yarn" class="sidebar-link">yarn</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#初始化-wuner-vite-cli" class="sidebar-link">初始化 wuner-vite-cli</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#安装依赖" class="sidebar-link">安装依赖</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#静态-web-服务器" class="sidebar-link">静态 web 服务器</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#link" class="sidebar-link">link</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#测试" class="sidebar-link">测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#vite-解决方案" class="sidebar-link">vite 解决方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#修改第三方模块的路径" class="sidebar-link">修改第三方模块的路径</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#测试-2" class="sidebar-link">测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#加载第三方模块" class="sidebar-link">加载第三方模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#测试-3" class="sidebar-link">测试</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#vite-解决方案-2" class="sidebar-link">Vite 解决方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#编译-vue-单文件组件" class="sidebar-link">编译 vue 单文件组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#测试-4" class="sidebar-link">测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#替换-vue-模块中的环境变量" class="sidebar-link">替换 vue 模块中的环境变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#测试-5" class="sidebar-link">测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-05/notes/w-006-customize-vite/#源码" class="sidebar-link">源码</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模拟-vite"><a href="#模拟-vite" class="header-anchor">#</a> 模拟 Vite</h1> <h2 id="vite-核心功能"><a href="#vite-核心功能" class="header-anchor">#</a> Vite 核心功能</h2> <ul><li>静态 Web 服务器
<ul><li>编译单文件组件</li> <li>拦截浏览器不识别的模块，并处理</li></ul></li> <li>HMR</li></ul> <h2 id="vite-工作步骤"><a href="#vite-工作步骤" class="header-anchor">#</a> Vite 工作步骤</h2> <p>当启动 Vite 的时候，首先会将当前项目目录作为静态 web 服务器的根目录。</p> <p>静态 web 服务器会拦截部分请求，例如当请求单文件组件的时候会实时编译，以及处理其他浏览器不能识别的模块（非 JS 模块）。</p> <p>通过 web socket 实现 HMR（暂不模拟）。</p> <h2 id="创建-vue3-x-项目"><a href="#创建-vue3-x-项目" class="header-anchor">#</a> 创建 Vue3.x 项目</h2> <p>用于测试我们模拟的 vite 工具</p> <h3 id="npm"><a href="#npm" class="header-anchor">#</a> npm</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> init vite-app vite-test-demo
<span class="token builtin class-name">cd</span> vite-test-demo
<span class="token function">npm</span> i
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="yarn"><a href="#yarn" class="header-anchor">#</a> yarn</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> create vite-app vite-test-demo
<span class="token builtin class-name">cd</span> vite-test-demo
<span class="token function">yarn</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="初始化-wuner-vite-cli"><a href="#初始化-wuner-vite-cli" class="header-anchor">#</a> 初始化 wuner-vite-cli</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> wuner-vite-cli
<span class="token builtin class-name">cd</span> wuner-vite-cli
<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;</span>index.js
<span class="token function">yarn</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h2> <p>Vite 内部使用 Koa 开启静态 Web 服务器。</p> <p>koa-send：静态文件处理的中间件。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> koa koa-send
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <p>配置 <code>bin</code> 字段，默认执行的 js 文件的路径：</p> <p><code>package.json</code></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wuner-vite-cli&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;koa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.13.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-send&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="静态-web-服务器"><a href="#静态-web-服务器" class="header-anchor">#</a> 静态 web 服务器</h2> <p>使用 <code>koa</code> 开发静态 <code>web</code> 服务器，默认返回根目录中的 <code>index.html</code></p> <p>创建一个中间件，负责处理静态文件，默认加载当前目录下（运行该命令行工具的目录中的 <code>index.html</code>）。</p> <p><code>index.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> send <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-send'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 开启静态文件服务器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">send</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    root<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    index<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running @ http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="link"><a href="#link" class="header-anchor">#</a> link</h2> <p><code>wuner-vite-cli</code> 根目录下运行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># npm</span>
<span class="token function">npm</span> <span class="token function">link</span>
<span class="token comment"># yarn</span>
<span class="token function">yarn</span> <span class="token function">link</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h2> <p>在 <code>vite-test-demo</code> 根目录下运行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>wuner-vite-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用浏览器访问 http://localhost:3000</p> <p>这时你将看到报错，如下图</p> <p><img src="data:image/png;base64,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" alt="notes"></p> <p><img src="/wuner-notes/assets/img/2.433297d0.png" alt="notes"></p> <p>在导入 vue 模块的时候，前面没有浏览器要求的相对路径地址（&quot;/&quot;, &quot;./&quot;, or &quot;../&quot;）。</p> <p>这种方式的导入，期望的是从 node_modules 中加载模块，这是打包工具的默认行为，但是浏览器不支持。</p> <h3 id="vite-解决方案"><a href="#vite-解决方案" class="header-anchor">#</a> vite 解决方案</h3> <p>使用 <code>vite</code> 运行 <code>vite-test-demo</code> 查看：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>vite
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/wuner-notes/assets/img/3.c123c714.png" alt="notes"> <img src="data:image/png;base64,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" alt="notes"></p> <p>通过查看 main.js 的 http 请求，我们可以看出 Vite 开启的 web 服务器在加载 main.js 时首先会处理第三方模块的 import 路径：vue =&gt; /@modules/vue.js；响应头 Response Headers 返回的 Content-Type 是 application/javascript，作用是告诉浏览器返回的文件是 JavaScript 文件。</p> <p>所以要在 web 服务器输出之前，先判断一下当前返回的文件是否是 JS 文件。 如果是 JS 文件，再去处理里面第三方模块的路径。 然后在请求 /@modules/vue.js 时处理这个不存在的路径，去 node_modules 中寻找对应的文件。</p> <h2 id="修改第三方模块的路径"><a href="#修改第三方模块的路径" class="header-anchor">#</a> 修改第三方模块的路径</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> send <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-send'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 流转化成字符串
 * @param stream
 * @returns {Promise}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">streamToString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token comment">// 读取流是一个异步的过程,所以要返回一个 Promise</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// chunks 存储读取到的 Buffer</span>
    <span class="token keyword">const</span> chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听读取到的 Buffer</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听读取完毕,将 Buffer 转化成字符串</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听读取失败</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 开启静态文件服务器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">send</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    root<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    index<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 修改第三方模块的路径</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断是否是 JS 文件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'application/javascript'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ctx.body 是返回给浏览器的 JS 文件,是一个流,要转化成字符串处理</span>
    <span class="token keyword">const</span> contents <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">streamToString</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 替换路径并重新赋值 ctx.body</span>
    <span class="token comment">// 替换 `from '` 为 `from '/@modules/`</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> contents<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(from\s+['&quot;])(?![\.\/])/g</span><span class="token punctuation">,</span> <span class="token string">'$1/@modules/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running @ http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试</h3> <p>重新运行脚本测试</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>wuner-vite-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/wuner-notes/assets/img/5.4635051b.png" alt="notes"></p> <p>如上图所示，我们已经成功修改了 vue 模块加载路径，但是浏览器不识别，我们需要在服务器去加载第三方模块。</p> <h2 id="加载第三方模块"><a href="#加载第三方模块" class="header-anchor">#</a> 加载第三方模块</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> send <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-send'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 流转化成字符串
 * @param stream
 * @returns {Promise}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">streamToString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token comment">// 读取流是一个异步的过程,所以要返回一个 Promise</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// chunks 存储读取到的 Buffer</span>
    <span class="token keyword">const</span> chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听读取到的 Buffer</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听读取完毕,将 Buffer 转化成字符串</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听读取失败</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 加载第三方模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断路径是否是以 `/@odules/` 开头</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/@modules/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 截取模块名称</span>
    <span class="token keyword">const</span> moduleName <span class="token operator">=</span> ctx<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取模块的入口文件(ESM模块的入口文件)</span>
    <span class="token comment">// 先找到这个模块的 package.json,再获取module字段的值</span>
    <span class="token keyword">const</span> pkgPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
      process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'node_modules'</span><span class="token punctuation">,</span>
      moduleName<span class="token punctuation">,</span>
      <span class="token string">'package.json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/node_modules'</span><span class="token punctuation">,</span> moduleName<span class="token punctuation">,</span> pkg<span class="token punctuation">.</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 开启静态文件服务器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 修改第三方模块的路径</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running @ http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h3 id="测试-3"><a href="#测试-3" class="header-anchor">#</a> 测试</h3> <p>重新运行脚本测试</p> <p><img src="/wuner-notes/assets/img/6.bf0aaaa0.png" alt="notes"></p> <p>如上图所示，<code>vue</code> 模块已成功被加载到，但是有两个浏览器不能识别的模块加载失败 <code>App.vue</code> 和 <code>index.css</code></p> <p>本次只模拟 js 类型处理，我们将注释 css 与 img 引用</p> <h3 id="vite-解决方案-2"><a href="#vite-解决方案-2" class="header-anchor">#</a> Vite 解决方案</h3> <p>浏览器只能处理 JS 模块，所以通过 import 加载的其他模块都需要在服务器端处理。</p> <p>当请求单文件组件的时候，需要在服务器上把单文件组件编译成 JS 模块，然后返回给浏览器。</p> <p><img src="/wuner-notes/assets/img/7.3da6a58c.png" alt="notes"> <img src="/wuner-notes/assets/img/8.5cc7a699.png" alt="notes"></p> <p>如上图所示，Vite 中处理单文件组件会发送两次请求：</p> <ul><li>第一次请求把单文件组件编译成对象</li> <li>第二次请求编译单文件组件的模板，返回一个 render 函数，并挂载到第一次请求编译的对象的 render 属性上</li></ul> <h2 id="编译-vue-单文件组件"><a href="#编译-vue-单文件组件" class="header-anchor">#</a> 编译 vue 单文件组件</h2> <p>安装 vue 3.x 编译单文件组件的模块 compiler-sfc</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#npm</span>
<span class="token function">npm</span> i @vue/compiler-sfc
<span class="token comment">#yarn</span>
<span class="token function">yarn</span> <span class="token function">add</span> @vue/compiler-sfc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> send <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-send'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compilerSFC <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/compiler-sfc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Readable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 流转化成字符串
 * @param stream
 * @returns {Promise}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">streamToString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">...</span>

<span class="token comment">/**
 * 字符串转化成流
 * @param text
 * @returns {*}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">stringToStream</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  stream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 标识 stream 已写完</span>
  stream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 加载第三方模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 开启静态文件服务器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. 处理单文件组件</span>
<span class="token comment">// 在获取文件之后,处理第三方模块之前</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断是否是单文件组件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> contents <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">streamToString</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Vue 2 的 compiler 返回一个 AST 对象</span>
    <span class="token comment">// Vue 3 的 compiler 返回一个包含 descriptor 和 errors 的对象</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> descriptor <span class="token punctuation">}</span> <span class="token operator">=</span> compilerSFC<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> code<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 第一次请求</span>
      code <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>script<span class="token punctuation">.</span>content<span class="token punctuation">;</span>

      <span class="token comment">// 改造code</span>
      code <span class="token operator">=</span> code<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/export\s+default\s+/g</span><span class="token punctuation">,</span> <span class="token string">'const __script = '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 拼接代码</span>
      code <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      import {render as __render} from &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?type=template&quot;
      __script.render = __render
      export default __script
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'template'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 第二次请求</span>
      <span class="token keyword">const</span> templateRender <span class="token operator">=</span> compilerSFC<span class="token punctuation">.</span><span class="token function">compileTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> source<span class="token operator">:</span> descriptor<span class="token punctuation">.</span>template<span class="token punctuation">.</span>content <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      code <span class="token operator">=</span> templateRender<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 告诉浏览器以 JS 方式识别该返回</span>
    ctx<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'application/javascript'</span><span class="token punctuation">;</span>

    <span class="token comment">// 将code转换成流输出给浏览器</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">stringToStream</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 修改第三方模块的路径</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running @ http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h3 id="测试-4"><a href="#测试-4" class="header-anchor">#</a> 测试</h3> <p>重新运行脚本测试</p> <p><img src="/wuner-notes/assets/img/9.e20984d4.png" alt="notes"></p> <p>如上图所示，源码中使用了 process.env.NODE_ENV。</p> <p>当前代码是在浏览器环境下执行的，process 是 node 环境的对象，浏览器环境没有这个对象，所以报错。</p> <p>这段源码的作用是让打包工具根据环境变量分别进行生产环境或者开发环境的打包操作。</p> <p>但是现在没有用打包工具，所以这句代码没有被处理，直接返回给了浏览器。</p> <p>所以应该在服务器处理一下，在返回 JS 模块之前，应该把 JS 模块中所有 process.env.NODE_ENV 都替换成 development（因为当前是开发环境下）。</p> <h2 id="替换-vue-模块中的环境变量"><a href="#替换-vue-模块中的环境变量" class="header-anchor">#</a> 替换 vue 模块中的环境变量</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> send <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-send'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compilerSFC <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/compiler-sfc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Readable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 流转化成字符串
 * @param stream
 * @returns {Promise}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">streamToString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">...</span>

<span class="token comment">/**
 * 字符串转化成流
 * @param text
 * @returns {*}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">stringToStream</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 加载第三方模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 开启静态文件服务器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. 处理单文件组件</span>
<span class="token comment">// 在获取文件之后,处理第三方模块之前</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 修改第三方模块的路径</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断是否是 JS 文件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'application/javascript'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ctx.body 是返回给浏览器的 JS 文件,是一个流,要转化成字符串处理</span>
    <span class="token keyword">const</span> contents <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">streamToString</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 替换路径并重新赋值 ctx.body</span>
    <span class="token comment">// 替换 `from '` 为 `from '/@modules/`</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> contents
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(from\s+['&quot;])(?![\.\/])/g</span><span class="token punctuation">,</span> <span class="token string">'$1/@modules/'</span><span class="token punctuation">)</span>
      <span class="token comment">// 继续替换 process 对象</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/process\.env\.NODE_ENV/g</span><span class="token punctuation">,</span> <span class="token string">'&quot;development&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running @ http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="测试-5"><a href="#测试-5" class="header-anchor">#</a> 测试</h3> <p>重新运行脚本测试</p> <p><img src="/wuner-notes/assets/img/10.9db0ee99.png" alt="notes"></p> <p>如上图所示，我们已经可以正常显示页面了</p> <h2 id="源码"><a href="#源码" class="header-anchor">#</a> <a href="https://gitee.com/Wuner/wuner-vite-cli" target="_blank" rel="noopener noreferrer">源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wuner-notes/fed-e-task-03-05/notes/w-005-vite/" class="prev">
        Vite
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
<script src="/wuner-notes/assets/js/app.a809ef8d.js" defer></script><script src="/wuner-notes/assets/js/3.aefe3dc3.js" defer></script><script src="/wuner-notes/assets/js/6.50a8d784.js" defer></script>
</body>
</html>
