<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>深入响应式原理 | Study Notes</title>
  <meta name="generator" content="VuePress 1.5.2">
  <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement('script');
      hm.src = 'https://hm.baidu.com/hm.js?408fc8ae9e93287c6ac296cfac03abf8';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  
  <meta name="description" content="大前端学习笔记">
    <meta name="keywords" content="Study Notes,Wuner,Vue,前端学习笔记,函数式编程,Promise,ES6+,TypeScript,JS性能优化,cli,脚手架,自动化构建,yeoman,plop,gulp,grunt,ESModule,webpack,rollup,lint,vue-router,vue-observe,virtual-dom,虚拟dom,vue源码解析,vue响应式原理,vue虚拟dom,vue模板编译,vue组件化,vue状态管理(vuex),服务端渲染(ssr),nuxtJs,搭建SSR">
  <link rel="preload" href="/wuner-notes/assets/css/0.styles.c6185683.css" as="style"><link rel="preload" href="/wuner-notes/assets/js/app.a809ef8d.js" as="script"><link rel="preload" href="/wuner-notes/assets/js/3.aefe3dc3.js" as="script"><link rel="preload" href="/wuner-notes/assets/js/5.499729e8.js" as="script"><link rel="prefetch" href="/wuner-notes/assets/js/10.7976e91f.js"><link rel="prefetch" href="/wuner-notes/assets/js/100.83923d25.js"><link rel="prefetch" href="/wuner-notes/assets/js/101.a6e0c361.js"><link rel="prefetch" href="/wuner-notes/assets/js/102.0beac992.js"><link rel="prefetch" href="/wuner-notes/assets/js/103.16658d3e.js"><link rel="prefetch" href="/wuner-notes/assets/js/104.229f702d.js"><link rel="prefetch" href="/wuner-notes/assets/js/105.7603531e.js"><link rel="prefetch" href="/wuner-notes/assets/js/106.c6cf5520.js"><link rel="prefetch" href="/wuner-notes/assets/js/107.2ba933e2.js"><link rel="prefetch" href="/wuner-notes/assets/js/108.496ff2cc.js"><link rel="prefetch" href="/wuner-notes/assets/js/109.ca18a9f1.js"><link rel="prefetch" href="/wuner-notes/assets/js/11.589a46d9.js"><link rel="prefetch" href="/wuner-notes/assets/js/110.2b88f986.js"><link rel="prefetch" href="/wuner-notes/assets/js/111.dd51c5d3.js"><link rel="prefetch" href="/wuner-notes/assets/js/112.cb8f456b.js"><link rel="prefetch" href="/wuner-notes/assets/js/113.58fcd0cb.js"><link rel="prefetch" href="/wuner-notes/assets/js/114.417e806c.js"><link rel="prefetch" href="/wuner-notes/assets/js/115.9a08e21a.js"><link rel="prefetch" href="/wuner-notes/assets/js/116.5d825eec.js"><link rel="prefetch" href="/wuner-notes/assets/js/117.38ea656b.js"><link rel="prefetch" href="/wuner-notes/assets/js/118.87c529e3.js"><link rel="prefetch" href="/wuner-notes/assets/js/119.cdfe8073.js"><link rel="prefetch" href="/wuner-notes/assets/js/12.9624a54d.js"><link rel="prefetch" href="/wuner-notes/assets/js/120.0d746ec4.js"><link rel="prefetch" href="/wuner-notes/assets/js/121.e7060a35.js"><link rel="prefetch" href="/wuner-notes/assets/js/122.e996cc4d.js"><link rel="prefetch" href="/wuner-notes/assets/js/123.b36e6eda.js"><link rel="prefetch" href="/wuner-notes/assets/js/124.d9aeb609.js"><link rel="prefetch" href="/wuner-notes/assets/js/125.6defae1b.js"><link rel="prefetch" href="/wuner-notes/assets/js/126.abe18c38.js"><link rel="prefetch" href="/wuner-notes/assets/js/127.47e4c3b2.js"><link rel="prefetch" href="/wuner-notes/assets/js/128.e254e598.js"><link rel="prefetch" href="/wuner-notes/assets/js/129.4ed94512.js"><link rel="prefetch" href="/wuner-notes/assets/js/13.b0ee3a30.js"><link rel="prefetch" href="/wuner-notes/assets/js/130.b3464e80.js"><link rel="prefetch" href="/wuner-notes/assets/js/131.2bce54d8.js"><link rel="prefetch" href="/wuner-notes/assets/js/132.b0bfb318.js"><link rel="prefetch" href="/wuner-notes/assets/js/133.cb916b45.js"><link rel="prefetch" href="/wuner-notes/assets/js/134.7d5ddb19.js"><link rel="prefetch" href="/wuner-notes/assets/js/135.6a00dc80.js"><link rel="prefetch" href="/wuner-notes/assets/js/136.c2ea2fc5.js"><link rel="prefetch" href="/wuner-notes/assets/js/137.171fb43e.js"><link rel="prefetch" href="/wuner-notes/assets/js/138.786f6a60.js"><link rel="prefetch" href="/wuner-notes/assets/js/139.7ae403b4.js"><link rel="prefetch" href="/wuner-notes/assets/js/14.1af6ecbe.js"><link rel="prefetch" href="/wuner-notes/assets/js/140.954d2ef0.js"><link rel="prefetch" href="/wuner-notes/assets/js/141.cd3408c4.js"><link rel="prefetch" href="/wuner-notes/assets/js/142.ad396f45.js"><link rel="prefetch" href="/wuner-notes/assets/js/143.ab063f89.js"><link rel="prefetch" href="/wuner-notes/assets/js/144.856bcd6a.js"><link rel="prefetch" href="/wuner-notes/assets/js/145.19bfaf21.js"><link rel="prefetch" href="/wuner-notes/assets/js/146.b6678f3d.js"><link rel="prefetch" href="/wuner-notes/assets/js/147.da39d200.js"><link rel="prefetch" href="/wuner-notes/assets/js/148.981b6bc2.js"><link rel="prefetch" href="/wuner-notes/assets/js/149.1337b9fe.js"><link rel="prefetch" href="/wuner-notes/assets/js/15.3c8f9d88.js"><link rel="prefetch" href="/wuner-notes/assets/js/150.999602c2.js"><link rel="prefetch" href="/wuner-notes/assets/js/151.572bccdb.js"><link rel="prefetch" href="/wuner-notes/assets/js/152.0e7ed536.js"><link rel="prefetch" href="/wuner-notes/assets/js/153.fc7aeac7.js"><link rel="prefetch" href="/wuner-notes/assets/js/154.876cdbb3.js"><link rel="prefetch" href="/wuner-notes/assets/js/155.9dfa71b1.js"><link rel="prefetch" href="/wuner-notes/assets/js/156.fa741ec7.js"><link rel="prefetch" href="/wuner-notes/assets/js/157.b1dcaaaa.js"><link rel="prefetch" href="/wuner-notes/assets/js/158.4f490352.js"><link rel="prefetch" href="/wuner-notes/assets/js/159.7dd29e40.js"><link rel="prefetch" href="/wuner-notes/assets/js/16.ab5dc4e7.js"><link rel="prefetch" href="/wuner-notes/assets/js/160.a4f90644.js"><link rel="prefetch" href="/wuner-notes/assets/js/161.794517fd.js"><link rel="prefetch" href="/wuner-notes/assets/js/162.d0347e26.js"><link rel="prefetch" href="/wuner-notes/assets/js/163.f502d3d1.js"><link rel="prefetch" href="/wuner-notes/assets/js/164.113359c3.js"><link rel="prefetch" href="/wuner-notes/assets/js/165.a7822bda.js"><link rel="prefetch" href="/wuner-notes/assets/js/166.8f815d80.js"><link rel="prefetch" href="/wuner-notes/assets/js/167.61e24439.js"><link rel="prefetch" href="/wuner-notes/assets/js/168.1bb14bf5.js"><link rel="prefetch" href="/wuner-notes/assets/js/169.e687b540.js"><link rel="prefetch" href="/wuner-notes/assets/js/17.c3e4c1f9.js"><link rel="prefetch" href="/wuner-notes/assets/js/170.07a4d5fe.js"><link rel="prefetch" href="/wuner-notes/assets/js/171.0e91ed26.js"><link rel="prefetch" href="/wuner-notes/assets/js/172.41d0a29d.js"><link rel="prefetch" href="/wuner-notes/assets/js/173.475948b8.js"><link rel="prefetch" href="/wuner-notes/assets/js/174.4c10b74e.js"><link rel="prefetch" href="/wuner-notes/assets/js/175.84aff17f.js"><link rel="prefetch" href="/wuner-notes/assets/js/176.2ee0965b.js"><link rel="prefetch" href="/wuner-notes/assets/js/177.8cdb75b7.js"><link rel="prefetch" href="/wuner-notes/assets/js/178.91477146.js"><link rel="prefetch" href="/wuner-notes/assets/js/179.7752a28c.js"><link rel="prefetch" href="/wuner-notes/assets/js/18.edfeea1b.js"><link rel="prefetch" href="/wuner-notes/assets/js/180.89909185.js"><link rel="prefetch" href="/wuner-notes/assets/js/181.add38058.js"><link rel="prefetch" href="/wuner-notes/assets/js/182.0bf95f16.js"><link rel="prefetch" href="/wuner-notes/assets/js/183.ff153ecc.js"><link rel="prefetch" href="/wuner-notes/assets/js/184.17b3918d.js"><link rel="prefetch" href="/wuner-notes/assets/js/185.962d670d.js"><link rel="prefetch" href="/wuner-notes/assets/js/186.d6910993.js"><link rel="prefetch" href="/wuner-notes/assets/js/187.8a5ada85.js"><link rel="prefetch" href="/wuner-notes/assets/js/188.46b5e769.js"><link rel="prefetch" href="/wuner-notes/assets/js/189.82f44dd5.js"><link rel="prefetch" href="/wuner-notes/assets/js/19.9cc2a7b5.js"><link rel="prefetch" href="/wuner-notes/assets/js/190.6cc8372f.js"><link rel="prefetch" href="/wuner-notes/assets/js/191.a33bd656.js"><link rel="prefetch" href="/wuner-notes/assets/js/192.7a2d0346.js"><link rel="prefetch" href="/wuner-notes/assets/js/193.f6d1ebba.js"><link rel="prefetch" href="/wuner-notes/assets/js/194.3408c045.js"><link rel="prefetch" href="/wuner-notes/assets/js/195.ca57f871.js"><link rel="prefetch" href="/wuner-notes/assets/js/196.2f778353.js"><link rel="prefetch" href="/wuner-notes/assets/js/197.b89f9012.js"><link rel="prefetch" href="/wuner-notes/assets/js/198.6d10dc84.js"><link rel="prefetch" href="/wuner-notes/assets/js/20.f52d8f50.js"><link rel="prefetch" href="/wuner-notes/assets/js/21.181487df.js"><link rel="prefetch" href="/wuner-notes/assets/js/22.7e731743.js"><link rel="prefetch" href="/wuner-notes/assets/js/23.67776d25.js"><link rel="prefetch" href="/wuner-notes/assets/js/24.952f3da8.js"><link rel="prefetch" href="/wuner-notes/assets/js/25.041f0768.js"><link rel="prefetch" href="/wuner-notes/assets/js/26.a8936c58.js"><link rel="prefetch" href="/wuner-notes/assets/js/27.f75ebb6c.js"><link rel="prefetch" href="/wuner-notes/assets/js/28.0c8492a7.js"><link rel="prefetch" href="/wuner-notes/assets/js/29.a1c74893.js"><link rel="prefetch" href="/wuner-notes/assets/js/30.fd3b777a.js"><link rel="prefetch" href="/wuner-notes/assets/js/31.67cbb794.js"><link rel="prefetch" href="/wuner-notes/assets/js/32.281f8859.js"><link rel="prefetch" href="/wuner-notes/assets/js/33.0b9aa40c.js"><link rel="prefetch" href="/wuner-notes/assets/js/34.af735477.js"><link rel="prefetch" href="/wuner-notes/assets/js/35.8bf0fd87.js"><link rel="prefetch" href="/wuner-notes/assets/js/36.4630365c.js"><link rel="prefetch" href="/wuner-notes/assets/js/37.99381559.js"><link rel="prefetch" href="/wuner-notes/assets/js/38.803f8518.js"><link rel="prefetch" href="/wuner-notes/assets/js/39.0594b31e.js"><link rel="prefetch" href="/wuner-notes/assets/js/4.6d605efe.js"><link rel="prefetch" href="/wuner-notes/assets/js/40.2c974435.js"><link rel="prefetch" href="/wuner-notes/assets/js/41.152b0e60.js"><link rel="prefetch" href="/wuner-notes/assets/js/42.fa640ede.js"><link rel="prefetch" href="/wuner-notes/assets/js/43.d2e99ad9.js"><link rel="prefetch" href="/wuner-notes/assets/js/44.912850e7.js"><link rel="prefetch" href="/wuner-notes/assets/js/45.af340e8d.js"><link rel="prefetch" href="/wuner-notes/assets/js/46.2c893977.js"><link rel="prefetch" href="/wuner-notes/assets/js/47.17265f1a.js"><link rel="prefetch" href="/wuner-notes/assets/js/48.372cf11b.js"><link rel="prefetch" href="/wuner-notes/assets/js/49.ef1de019.js"><link rel="prefetch" href="/wuner-notes/assets/js/50.9fc862de.js"><link rel="prefetch" href="/wuner-notes/assets/js/51.9e3df210.js"><link rel="prefetch" href="/wuner-notes/assets/js/52.da2225f6.js"><link rel="prefetch" href="/wuner-notes/assets/js/53.d9f34217.js"><link rel="prefetch" href="/wuner-notes/assets/js/54.77a9fff9.js"><link rel="prefetch" href="/wuner-notes/assets/js/55.e606317e.js"><link rel="prefetch" href="/wuner-notes/assets/js/56.02bce45f.js"><link rel="prefetch" href="/wuner-notes/assets/js/57.6ad0ff97.js"><link rel="prefetch" href="/wuner-notes/assets/js/58.cd8e403d.js"><link rel="prefetch" href="/wuner-notes/assets/js/59.ddb0aa03.js"><link rel="prefetch" href="/wuner-notes/assets/js/6.50a8d784.js"><link rel="prefetch" href="/wuner-notes/assets/js/60.f1a2db78.js"><link rel="prefetch" href="/wuner-notes/assets/js/61.7b9056be.js"><link rel="prefetch" href="/wuner-notes/assets/js/62.cad0ce41.js"><link rel="prefetch" href="/wuner-notes/assets/js/63.76522648.js"><link rel="prefetch" href="/wuner-notes/assets/js/64.6c93bdcb.js"><link rel="prefetch" href="/wuner-notes/assets/js/65.71b0fd1a.js"><link rel="prefetch" href="/wuner-notes/assets/js/66.898de639.js"><link rel="prefetch" href="/wuner-notes/assets/js/67.f2ef50b9.js"><link rel="prefetch" href="/wuner-notes/assets/js/68.9fb2e4f9.js"><link rel="prefetch" href="/wuner-notes/assets/js/69.1443e812.js"><link rel="prefetch" href="/wuner-notes/assets/js/7.5d593870.js"><link rel="prefetch" href="/wuner-notes/assets/js/70.8383b983.js"><link rel="prefetch" href="/wuner-notes/assets/js/71.634c9345.js"><link rel="prefetch" href="/wuner-notes/assets/js/72.507e6f87.js"><link rel="prefetch" href="/wuner-notes/assets/js/73.807954f0.js"><link rel="prefetch" href="/wuner-notes/assets/js/74.9c23de88.js"><link rel="prefetch" href="/wuner-notes/assets/js/75.97c3d5e0.js"><link rel="prefetch" href="/wuner-notes/assets/js/76.201de7ca.js"><link rel="prefetch" href="/wuner-notes/assets/js/77.2c7ed4a5.js"><link rel="prefetch" href="/wuner-notes/assets/js/78.b08060f6.js"><link rel="prefetch" href="/wuner-notes/assets/js/79.068f88a5.js"><link rel="prefetch" href="/wuner-notes/assets/js/8.7e45c9f6.js"><link rel="prefetch" href="/wuner-notes/assets/js/80.67e71c37.js"><link rel="prefetch" href="/wuner-notes/assets/js/81.453ffa1d.js"><link rel="prefetch" href="/wuner-notes/assets/js/82.19d9b23e.js"><link rel="prefetch" href="/wuner-notes/assets/js/83.e28951a8.js"><link rel="prefetch" href="/wuner-notes/assets/js/84.acf83fd2.js"><link rel="prefetch" href="/wuner-notes/assets/js/85.a148175c.js"><link rel="prefetch" href="/wuner-notes/assets/js/86.29b224ad.js"><link rel="prefetch" href="/wuner-notes/assets/js/87.d0a3a990.js"><link rel="prefetch" href="/wuner-notes/assets/js/88.6dc2007c.js"><link rel="prefetch" href="/wuner-notes/assets/js/89.dce4546d.js"><link rel="prefetch" href="/wuner-notes/assets/js/9.dd4046db.js"><link rel="prefetch" href="/wuner-notes/assets/js/90.95e77eb4.js"><link rel="prefetch" href="/wuner-notes/assets/js/91.1c2421b2.js"><link rel="prefetch" href="/wuner-notes/assets/js/92.3a81c211.js"><link rel="prefetch" href="/wuner-notes/assets/js/93.5f6d6263.js"><link rel="prefetch" href="/wuner-notes/assets/js/94.8a9faaa2.js"><link rel="prefetch" href="/wuner-notes/assets/js/95.483f58d5.js"><link rel="prefetch" href="/wuner-notes/assets/js/96.e1fa253e.js"><link rel="prefetch" href="/wuner-notes/assets/js/97.4ee07616.js"><link rel="prefetch" href="/wuner-notes/assets/js/98.6728a5ee.js"><link rel="prefetch" href="/wuner-notes/assets/js/99.34ed8e76.js"><link rel="prefetch" href="/wuner-notes/assets/js/vendors~docsearch.529fd6da.js">
  <link rel="stylesheet" href="/wuner-notes/assets/css/0.styles.c6185683.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wuner-notes/" class="home-link router-link-active"><!----> <span class="site-name">Study Notes</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://blog.csdn.net/qq_32090185" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/notes/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/notes/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/notes/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/notes/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/notes/" class="nav-link router-link-active">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/notes/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/notes/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/notes/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/notes/" class="nav-link">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/notes/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="题目" class="dropdown-title"><span class="title">题目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/" class="nav-link router-link-active">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/" class="nav-link">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><a href="/wuner-notes/interview-questions/w-001-js-base/" class="nav-link">
  面试题
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://blog.csdn.net/qq_32090185" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/notes/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/notes/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/notes/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/notes/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/notes/" class="nav-link router-link-active">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/notes/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/notes/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/notes/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/notes/" class="nav-link">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/notes/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="题目" class="dropdown-title"><span class="title">题目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-01/" class="nav-link">
  函数式编程与 JS 异步编程、手写 Promise
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-01-02/" class="nav-link">
  ES 新特性与 TypeScript、JS 性能优化
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-01/" class="nav-link">
  开发脚手架及封装自动化构建工作流
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-02-02/" class="nav-link">
  模块化开发与规范化标准
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-01/" class="nav-link router-link-active">
  手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-02/" class="nav-link">
  Vue.js 源码分析（响应式、虚拟 DOM、模板编译和组件化）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-03/" class="nav-link">
  Vuex 数据流管理及Vue.js 服务端渲染（SSR）
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-04/" class="nav-link">
  搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-05/" class="nav-link">
  Vue.js 3.0 Composition APIs 及 3.0 原理剖析
</a></li><li class="dropdown-item"><!----> <a href="/wuner-notes/fed-e-task-03-06/" class="nav-link">
  Vue.js + Vuex + TypeScript 实战项目开发与项目优化
</a></li></ul></div></div><div class="nav-item"><a href="/wuner-notes/interview-questions/w-001-js-base/" class="nav-link">
  面试题
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/wuner-notes/fed-e-task-03-01/notes/" aria-current="page" class="sidebar-link">手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/wuner-notes/fed-e-task-03-01/notes/w-001-vue-router/" class="sidebar-heading clickable"><span>Vue Router</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/" aria-current="page" class="active sidebar-link">深入响应式原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#vue2-x-响应式原理" class="sidebar-link">Vue2.x 响应式原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#对象单属性数据劫持" class="sidebar-link">对象单属性数据劫持</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#对象多属性数据劫持" class="sidebar-link">对象多属性数据劫持</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#vue3-x-响应式原理" class="sidebar-link">vue3.x 响应式原理</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#发布订阅模式和观察者模式" class="sidebar-link">发布订阅模式和观察者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#发布-订阅模式" class="sidebar-link">发布/订阅模式</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#vue-的自定义事件" class="sidebar-link">Vue 的自定义事件</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#兄弟组件通信过程" class="sidebar-link">兄弟组件通信过程</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#模拟-vue-自定义事件的实现" class="sidebar-link">模拟 Vue 自定义事件的实现</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#观察者模式" class="sidebar-link">观察者模式</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#vue-响应式原理模拟" class="sidebar-link">Vue 响应式原理模拟</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#整体分析" class="sidebar-link">整体分析</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#vue" class="sidebar-link">Vue</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#observer" class="sidebar-link">Observer</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#compiler" class="sidebar-link">Compiler</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#nodetype" class="sidebar-link" style="padding-left:3rem;">nodeType</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#dep-dependency" class="sidebar-link">Dep(Dependency)</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#watcher" class="sidebar-link">Watcher</a></li></ul></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#总结-2" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header"><a href="/wuner-notes/fed-e-task-03-01/notes/w-002-vue-reactivity/#整体流程" class="sidebar-link">整体流程</a></li></ul></li></ul></li><li><section class="sidebar-group collapsable depth-0"><a href="/wuner-notes/fed-e-task-03-01/notes/w-003-virtual-dom/" class="sidebar-heading clickable"><span>虚拟 DOM（Virtual DOM）</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="深入响应式原理"><a href="#深入响应式原理" class="header-anchor">#</a> 深入响应式原理</h1> <p>数据响应式、双向绑定、数据驱动</p> <ul><li><p>数据响应式</p> <p>数据模型仅仅是普通的 JavaScript 对象，而当我们修改数据时，视图会进行更新，避免了繁琐的 DOM 操作，提高开发效率</p></li> <li><p>双向绑定</p> <ul><li>数据改变，视图改变；视图改变，数据也随之改变</li> <li>我们可以使用 v-model 在表单元素上创建双向数据绑定</li></ul></li> <li><p>数据驱动是 Vue 最独特的特性之一</p> <p>开发过程中仅需要关注数据本身，不需要关心数据是如何渲染到视图</p></li></ul> <h2 id="vue2-x-响应式原理"><a href="#vue2-x-响应式原理" class="header-anchor">#</a> <a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener noreferrer">Vue2.x 响应式原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>当你把一个普通的 JavaScript 对象传入 Vue 实例作为 data 选项，Vue 将遍历此对象所有的 property，并使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer">Object.defineProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 把这些 property 全部转为 getter/setter。Object.defineProperty 是 ES5 中一个无法 shim 的特性，这也就是 Vue 不支持 IE8 以及更低版本浏览器的原因。</p> <h3 id="对象单属性数据劫持"><a href="#对象单属性数据劫持" class="header-anchor">#</a> 对象单属性数据劫持</h3> <ul><li><p>configurable</p> <p>当且仅当该属性的 configurable 键值为 true 时，该属性的描述符才能够被改变，同时该属性也能从对应的对象上被删除。</p></li> <li><p>enumerable</p> <p>当且仅当该属性的 enumerable 键值为 true 时，该属性才会出现在对象的枚举属性中。
默认为 false。</p></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
      <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'在控制台输入vm.msg = 123'</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 模拟Vue中的data选项</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 模拟vue实例</span>
      <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 数据劫持：当访问或者设置 vm 中的成员的时候，做一些干预操作</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 当获取值的时候执行</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 当赋值的时候执行</span>
        <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'赋值msg ==&gt; '</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          data<span class="token punctuation">.</span>msg <span class="token operator">=</span> val<span class="token punctuation">;</span>
          <span class="token comment">// 数据更改，更新 DOM 的值</span>
          document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> val<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="对象多属性数据劫持"><a href="#对象多属性数据劫持" class="header-anchor">#</a> 对象多属性数据劫持</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'1231'</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        msg<span class="token operator">:</span> <span class="token string">'成功'</span><span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">获取 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">==&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">赋值 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">==&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
            document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> val<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="vue3-x-响应式原理"><a href="#vue3-x-响应式原理" class="header-anchor">#</a> vue3.x 响应式原理</h2> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">Proxy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>直接监听对象，而非属性。</li> <li><code>ES6</code>中新增，IE 不支持，性能由浏览器优化</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'在控制台输入vm.msg = 123'</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
      msg<span class="token operator">:</span> <span class="token string">'成功'</span><span class="token punctuation">,</span>
      code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">获取</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">===&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">设置</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">===&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="发布订阅模式和观察者模式"><a href="#发布订阅模式和观察者模式" class="header-anchor">#</a> 发布订阅模式和观察者模式</h2> <h3 id="发布-订阅模式"><a href="#发布-订阅模式" class="header-anchor">#</a> 发布/订阅模式</h3> <ul><li>订阅者</li> <li>发布者</li> <li>信号中心</li></ul> <blockquote><p>我们假定，存在一个&quot;信号中心&quot;，某个任务执行完成，就向信号中心&quot;发布&quot;（publish）一个信号，其他任务可以向信号中心&quot;订阅&quot;（subscribe）这个信号，从而知道什么时候自己可以开始执行。这就叫做&quot;发布/订阅模式&quot;（publish-subscribe pattern）</p></blockquote> <h3 id="vue-的自定义事件"><a href="#vue-的自定义事件" class="header-anchor">#</a> <a href="https://cn.vuejs.org/v2/guide/components-custom-events.html" target="_blank" rel="noopener noreferrer">Vue 的自定义事件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dataChange1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'dataChange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="兄弟组件通信过程"><a href="#兄弟组件通信过程" class="header-anchor">#</a> 兄弟组件通信过程</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// eventBus.js
// 事件中心
export let eventHub = new Vue()

// ComponentA.vue
import {eventHub} from './eventBus'
// 发布者
addTodo: function () {
// 发布消息(事件)
eventHub.$emit('add-todo', { text: this.newTodoText })
this.newTodoText = ''
}
// ComponentB.vue
import {eventHub} from './eventBus'
// 订阅者
created: function () {
// 订阅消息(事件)
eventHub.$on('add-todo', this.addTodo)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="模拟-vue-自定义事件的实现"><a href="#模拟-vue-自定义事件的实现" class="header-anchor">#</a> 模拟 Vue 自定义事件的实现</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @author Wuner
 * @date 2020/7/29 21:58
 * @description
 */</span>
<span class="token keyword">class</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 订阅通知</span>
  <span class="token function">$on</span><span class="token punctuation">(</span><span class="token parameter">eventType<span class="token punctuation">,</span> handle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 发布通知</span>
  <span class="token function">$emit</span><span class="token punctuation">(</span><span class="token parameter">eventType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">handle</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试</span>
<span class="token keyword">let</span> ev <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ev<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ev<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ev<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ev<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ev<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="观察者模式"><a href="#观察者模式" class="header-anchor">#</a> 观察者模式</h3> <ul><li>观察者(订阅者) -- Watcher
<ul><li>update()：当事件发生时，具体要做的事情</li></ul></li> <li>目标(发布者) -- Dep
<ul><li>subs 数组：存储所有的观察者</li> <li>addSub()：添加观察者</li> <li>notify()：当事件发生，调用所有观察者的 update() 方法</li></ul></li> <li>没有事件中心</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @author Wuner
 * @date 2020/7/29 22:45
 * @description
 */</span>
<span class="token comment">// 目标(发布者)</span>
<span class="token comment">// Dependency</span>
<span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 存储所有的观察者</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 添加观察者</span>
  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sub <span class="token operator">&amp;&amp;</span> sub<span class="token punctuation">.</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 通知所有观察者</span>
  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 观察者(订阅者)</span>
<span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试</span>
<span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>

dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ul><li>观察者模式是由具体目标调度，比如当事件触发，Dep 就会去调用观察者的方法，所以观察者模式的订阅者与发布者之间是存在依赖的。</li> <li>发布/订阅模式由统一调度中心调用，因此发布者和订阅者不需要知道对方的存在。</li></ul> <p><img src="/wuner-notes/assets/img/1.61776f1a.png" alt="note"></p> <h2 id="vue-响应式原理模拟"><a href="#vue-响应式原理模拟" class="header-anchor">#</a> Vue 响应式原理模拟</h2> <h3 id="整体分析"><a href="#整体分析" class="header-anchor">#</a> 整体分析</h3> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyEAAADaCAYAAACxU020AAAgAElEQVR4Xu3dPegl1f0/8BHEiOCCCGKlC4JPIAtaiFqsT6uIWC4qWFiIT4VgoZ2FVtpoI0giaCOIio2FRZJN0piwyJc8mBRpJGm2CSJYmGR/yP643///7m92dh7OzJ05c865rwUh8Ttz5nNen3Nnzvve+3UvOXfu3LnKHwIECBAgQIAAAQIECEQSuEQIiSTtMgQIECBAgAABAgQIHAoIIRYCAQIECBAgQIAAAQJRBYSQqNwuRoAAAQIECBAgQICAEGINECBAgAABAgQIECAQVUAIicrtYgQIECBAgAABAgQICCHWAAECBAgQIECAAAECUQWEkKjcLkaAAAECBAgQIECAgBBiDRAgQIAAAQIECBAgEFVACInK7WIECBAgQIAAAQIECAgh1gABAgQIECBAgAABAlEFhJCo3C5GgAABAgQIECBAgIAQYg0QIECAAAECBAgQIBBVQAiJyu1iBAgQIECAAAECBAgIIdYAAQIECBAgQIAAAQJRBYSQqNwuRoAAAQIECBAgQICAEGINECBAgAABAgQIECAQVUAIicrtYgQIECBAgAABAgQICCHWAAECBAgQIECAAAECUQWEkKjcLkaAAAECBAgQIECAgBBiDRAgQIAAAQIECBAgEFVACInK7WIECBAgQIAAAQIECAgh1gABAgQIECBAgAABAlEFhJCo3C5GgAABAgQIECBAgMDiIeSOO+6gTCBrgYODg6zrV/yFAu5JVkTuAu5JuXdQ/QQIbASEEOuAwICAB35ZS0QIKauf+zgb96R97Lo5EyhPIFoIcdMsb/GUPqPtZtXaLavT+lpWP/dpNtbuPnXbXAmULyCElN9jM5wo4IE/ES7x0/Q18QYpr1PA2rU4CBAoSUAIKamb5jKrgAf+rJzJDKavybRCISMFrN2RYA4nQCBpASEk6fYobk0BD/w19Ze7tr4uZ2vkZQWs3WV9jU6AQFwBISSut6tlJOCBn1GzRpSqryOwHJqUgLWbVDsUQ4DAjgJCyI6ATi9XwAO/zN7qa5l93YdZWbv70GVzJLA/AkLI/vTaTEcKeOCPBMvkcH3NpFHKvEjA2rUoCBAoSUAIKamb5jKrgAf+rJzJDKavybRCISMFrN2RYA4nQCBpASEk6fYobk0BD/w19Ze7tr4uZ2vkZQWs3WV9jU6AQFwBISSut6tlJOCBn1GzRpSqryOwHJqUgLWbVDsUQ4DAjgJCyI6ATi9XwAM/3d5+//331VVXXTWpQH2dxOakBASs3QSaoAQCBGYTEEJmozRQaQIe+Ol29Mknn6xuvfXW6pZbbqluu+226qabbgouVl+DqWY5cON9cHBwONb2f7f9u+bFmsd0FbMde/vz+nl9/27oZ23jzAKywyDW7g54TiVAIDkBISS5lvzfg7qrtBQfjgky7lySB/7OhIsNsO3N5gJXXnnlYSDZ/LP593fddVfvdWP0tV7ftpiQzfJiYBEH7gsBbfZd97OxQSVWCFnz/lv3a1tjEdvsUgSSEHjuueeqZ599NolaFDFeQAgZbxbljJAHc5RC9vgiMTare8y709T7NmDXX3/94Sckd999d3XixInqsssuu+BaS/e1a6O9KaIeRNbczO6E33Nyc059fdpYzLGRrn/KEjqvrj4M1dsXdEKvvctxQsgues4tUUAIyburQkii/RNC1m/M0pvV9WeYbwWhm9dNANkEkvvvv7968MEHq2uvvfb8xrf5ycRcGn2v3XoQ2YcQUjcd+hSkLcA0v8a1GW/oE5K+T2Lq5w99WtXXn7V6554016vUOLkL/OIXv6h+/vOfV0JI3p0UQhLtX0gIGXrYbh+42ykutelKlHDnskI3ujtfyACzC5w7d6665JJLesdd4vUwtDlt20DX11nbV7baXr9d52zH7xuzbSPfdY36pxVDXkPhq96MtnGnhJC2Bg/dF7uuE/J6X/uTLCFk9luFATMVEEIybVyjbCEk4T72PZSbG4ntNJqbnNLfeV2yfSGbkiWvb+xlBYY21VOuPjaENF+fIa/X5ka07zXfdp8IvUeM3fB2bf7b5tQWktrud9tzh16LXV/tGvokpes+Wu99yBtCU9bKlHPG9mTKNZxDIAcBISSHLg3XKIQMG612xBwhZO137lbDm+HCHvgzIC40xNCmtHnZe++99/D3QzZfybrzzjsPf5xCCOn7ZfXQzW/bpyt9m+i+44fG6mvnmADWrK8tjHUFsinXGZpz6DJd+37qnhTaKceVLiCElNFhISTxPm4fnkNfMdhOo+1dzvoUl9h4JU44uTwP/Ml0i58YEkI2xzzwwAOHwePqq68+X9OSfR2zQQ55TbfV2jb3tnf86/eE7Ya+7VOUZrP6xhobQvr61PyF8qFA1nXttmAQ8mlP26cxbdcIDYOLL/r///swSwXoGPW7BoG5BISQuSTXHUcIWdd/8Oq7hhChY5C484AlN6vTq3LmRqBrc3vzzTdX991332HwOHr0aCvWkn3tG3vok83tvNpes6GfUAxtmENqaHtDI2TVDV27PkZfSGi7fpdr33y67p1D5zQ3+WPmFeK0yzFLrt1d6nIugdgCQkhs8WWuJ4Qs4zrbqGNCSNe7nFPf2ZxtEpkO5IGfbuPqIeS6666rjh8/fhg+jh07Nlj00n3t+/Si+a59fcMbGmDaXudDr/G+DXmzhqGxuoC7NuttobHPoRlCQu+B9eO2Y2x/V6Tva1RtdYeEvr75Di7CiQcsvXYnluU0AtEFhJDo5ItcUAhZhHXeQUMf7l0P3PoDed7Kyh7NAz/d/m5+v2Pzex6bf+65555Rhcboaz0kdb3+ujbN9U1437ltPxu6V3R9yjJ2rLFBpG7enHdX6GmGjzbTvhA35dOTtnkNhZRRi2/Hg2Os3R1LdDqBKAJCSBTmxS8ihCxO7AK5Cnjgp9u5s2fPXvSXEIZWq6+hUuOPa27Y+4JAPUC0Ba9mMBobBpqfZtRn0/yvaY0JZ5tx1vgUZHvdNrfxnXIGgbwFhJC8+7etXggpo49msYCAzeoCqAkMqa/LNmGtDfqys/q/0decn7Ubq8uuk7qAEJJ6h8LqE0LCnBy1hwIe+GU2XV/L7Os+zMra3Ycum2OIgBASopT+MUJI+j1S4UoCHvgrwS98WX1dGNjwiwlYu4vRGjgzASEks4Z1lCuElNFHs1hAwAN/AdQEhtTXBJqghEkC1u4kNicVKCCElNFUIaSMPprFAgIe+AugJjCkvibQBCVMErB2J7E5qUABIaSMpgohZfTRLBYQ8MBfADWBIfU1gSYoYZKAtTuJzUkFCgghZTRVCCmjj2axgIAH/gKoCQyprwk0QQmTBKzdSWxOKlBACCmjqUJIGX00iwUEPPAXQE1gSH1NoAlKmCRg7U5ic1KBAkJIGU0VQsroo1ksIOCBvwBqAkPqawJNUMIkAWt3EpuTChQQQspoarQQUgaXWeyjQNvfpryPDqXMebuRK2U+5rF/Au5J+9dzM75QQAgpY0UIIWX00SwWFPDAXxB3haGFkBXQXXJWAfekWTkNlqGAEJJh01pKXjyElMGU9iz+85//VJdffnnaRaqOAAECBAgQIDCDgBAyA2ICQwghCTRhaglehFPlnEeAAAECBAjkKmD/k2vnLqxbCMm4j16EGTdP6QQIECBAgMAkAfufSWzJnSSEJNeS8IK8CMOtHEmAAAECBAiUIWD/U0YfhZCM++hFmHHzlE6AAAECBAhMErD/mcSW3ElCSHItCS/IizDcypEECBAgQIBAGQL2P2X0UQjJuI9ehBk3T+kECBAgQIDAJAH7n0lsyZ0khCTXkvCCvAjDrRxJgAABAgQIlCFg/1NGH4WQjPvoRZhx85ROgAABAgQITBKw/5nEltxJQkhyLQkvyIsw3MqRBAgQIECAQBkC9j9l9FEIybiPXoQZN0/pBAgQIECAwCQB+59JbMmdJIQk15LwgrwIw60cSYAAAQIECJQhYP9TRh+FkIz76EWYcfOUToAAAQIECEwSsP+ZxJbcSUJIci0JL8iLMNzKkQQIECBAgEAZAvY/ZfRRCMm4j16EGTdP6QQIECBAgMAkAfufSWzJnSSEJNeS8IK8CMOtHEmAAAECBAiUIWD/U0YfhZCM++hFmHHzlE6AAAECBAhMErD/mcSW3ElCSHItCS/IizDcypEECBAgQIBAGQL2P2X0UQjJuI9ehBk3T+kECBAgQIDAJAH7n0lsyZ0khCTXkvCCvAjDrRxJgAABAgQIlCFg/1NGH4WQjPvoRZhx85ROgAABAgQITBKw/5nEltxJQkhyLQkvyIsw3MqRBAgQIECAQBkC9j9l9FEIybiPXoQZN0/pBAgQIECAwCQB+59JbMmdJIQk15LwgrwIw60cSYAAAQIECJQhYP9TRh+FkIz76EWYcfOUToAAAQIECEwSsP+ZxJbcSUJIci0JL8iLMNzKkQQIECBAgEAZAvY/ZfRRCMm4j16EGTdP6QQIECBAgMAkgbb9z48//lhdccUVk8Zz0joCQsg67rNcVQiZhdEgBAgQIECAQKICH374YfXuu+8GVffyyy9XTz31VNCxDlpfQAhZvweTKxBCJtM5kQABAgQIEMhA4Ntvv61Onjw5WOmll15avffee9Xtt98+eKwD0hAQQtLow6QqhJBJbE4iQIAAAQIEMhJ48cUXq9OnT/dWfOzYseqDDz7IaFZKFUIyXgNCSMbNUzoBAgQIECAQJPDpp59Wb731Vu+xTzzxRPXKK68EjeegNASEkDT6MKkKIWQSm5MIECBAgACBjAS+++676pFHHql++umnzqrfeOON6tFHH81oVkoVQjJeA0JIxs1TOgECBAgQIBAs8Oqrr1anTp1qPf6aa66pPvnkk+rIkSPB4zlwfQEhZP0eTK5ACJlM50QCBAgQIEAgI4Evv/yyeu2111orPn78ePX2229nNBulbgSEkIzXgRCScfOUToAAAQIECAQLnD17tnr44YerH3744aJzXnjhheqZZ54JHsuBaQgIIWn0YVIVQsgkNicRIECAAAECGQq8/vrr1RdffHFR5Z9//nl19OjRDGe03yULIRn3XwjJuHlKJ0CAAAECBEYJfPXVV9VLL710wTk33nhj9fHHH48ax8FpCAghafRhUhVCyCQ2JxEgQIAAAQKZCjz22GPVmTNnzlf/+OOPV5tfWvcnPwEhJL+ena9YCMm4eUonQIAAAQIERgu888471UcffXT+vPfff9/fkj5aMY0ThJA0+jCpCiFkEpuTCBAgQIAAgUwFvvnmm+rpp58+rP7yyy+vNl/R8idPASEkz74dVi2EZNw8pRMgQIAAAQKTBB566KFq8xcY3nDDDdXmb1P3J08BISTPvgkhGfdN6QQIECBAgMB0geeff776+uuvqxMnTlRvvvnm9IGcuaqAELIq/24X90nIbn7OJkCAAAECSwnccccdSw1tXAJRBA4ODha9jhCyKO+ygwshy/oanQABAgQITBUQQqbKOS8VASEklU4kWIcQkmBTlESAAAECBKqq2oaQpTdy+4r92WefVSdPntzX6S8671hr1ychi7Zx2cGFkGV9jU6AAAECBKYKxNrITa3PeQS6BGKtXSEk4zUohGTcPKUTIECAQNECsTZyRSOa3CoCsdauELJKe+e5qBAyj6NRCBAgQIDA3AKxNnJz1208ArHWrhCS8VoTQjJuntIJECBAoGiBWBu5ohFNbhWBWGtXCFmlvfNcVAiZx9EoBAgQIEBgboFYG7m56zYegVhrVwjJeK0JIRk3T+kECBAgULRArI1c0Ygmt4pArLUrhKzS3nkuKoTM42gUAgQIECAwt0CsjdzcdRuPQKy1K4RkvNaEkIybp3QCBAgQKFog1kauaESTW0Ug1toVQlZp7zwXFULmcTQKAQIECBCYWyDWRm7uuo1HINbaFUIyXmtCSMbNUzoBAgQIFC0QayNXNKLJrSIQa+0KIau0d56LCiHzOBqFAAECBAjM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" alt="note"></p> <ul><li><p>Vue</p> <p>把 data 中的成员注入到 Vue 实例，并且把 data 中的成员转成 getter/setter</p></li> <li><p>Observer（数据劫持）</p> <p>能够对数据对象的所有属性进行监听，如有变动可拿到最新值并通知 Dep</p></li> <li><p>Compiler（解析指令）</p> <p>解析每个元素中的指令/插值表达式，并替换成相应的数据</p></li> <li><p>Dep（订阅者）</p> <p>添加观察者(watcher)，当数据变化通知所有观察者</p></li> <li><p>Watcher（观察者）</p> <p>数据变化更新视图</p></li></ul> <h3 id="vue"><a href="#vue" class="header-anchor">#</a> Vue</h3> <ul><li>负责接收初始化的参数(选项)</li> <li>负责把 data 中的属性注入到 Vue 实例，转换成 getter/setter</li> <li>负责调用 observer 监听 data 中所有属性的变化</li> <li>负责调用 compiler 解析指令/插值表达式</li></ul> <p><img src="/wuner-notes/assets/img/3.34336ff4.png" alt="note"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @author Wuner
 * @date 2020/7/29 23:34
 * @description
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 初始化参数(选项)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
    <span class="token comment">// 判断el是否是字符串，如果是的话，则通过querySelector找到dom节点，否则直接赋值dom</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> <span class="token keyword">typeof</span> el <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">:</span> el<span class="token punctuation">;</span>
    <span class="token comment">// 负责把data中的属性，注入到vue实例，并转换为getter和setter</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_proxyData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用 observer 监听 data 中所有属性的变化</span>
    <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 编译</span>
    <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">_proxyData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历 data 的所有属性</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="observer"><a href="#observer" class="header-anchor">#</a> Observer</h3> <ul><li>负责把 data 选项中的属性转换成响应式数据</li> <li>data 中的某个属性也是对象，把该属性转换成响应式数据</li> <li>数据变化发送通知</li></ul> <p><img src="/wuner-notes/assets/img/4.4a8708a8.png" alt="note"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @author Wuner
 * @date 2020/7/30 0:12
 * @description
 */</span>
<span class="token comment">// 负责数据劫持</span>
<span class="token comment">// 把 $data 中的成员转换成 getter/setter</span>
<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断数据是否是对象，如果是对象，则遍历对象的所有属性，设置为 getter/setter</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 遍历 data 的所有成员</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 定义响应式成员</span>
  <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果val是对象，，继续设置它下面的成员为响应式数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 收集依赖</span>
        Dep<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 这里val不能通过data[key]获取，否则会陷入自调用死循环</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里val不能通过data[key]获取，否则会陷入自调用死循环</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> val<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
        <span class="token comment">// 如果newVal被赋值为对象，则继续设置它下面的成员为响应式数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 发送通知</span>
        dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="compiler"><a href="#compiler" class="header-anchor">#</a> Compiler</h3> <ul><li>负责编译模板，解析指令/插值表达式</li> <li>负责页面的首次渲染</li> <li>当数据变化后重新渲染视图</li></ul> <p><img src="/wuner-notes/assets/img/5.705e5d03.png" alt="note"></p> <h4 id="nodetype"><a href="#nodetype" class="header-anchor">#</a> nodeType</h4> <table><thead><tr><th>常量</th> <th>值</th> <th>描述</th></tr></thead> <tbody><tr><td>Node.ELEMENT_NODE</td> <td>1</td> <td>一个 元素 节点，例如 <code>&lt;p&gt;</code> 和 <code>&lt;div&gt;</code>。</td></tr> <tr><td>Node.TEXT_NODE</td> <td>3</td> <td>Element 或者 Attr 中实际的 文字</td></tr> <tr><td>Node.CDATA_SECTION_NODE</td> <td>4</td> <td>一个 CDATASection，例如 &lt;!CDATA[[ … ]]&gt;。</td></tr> <tr><td>Node.PROCESSING_INSTRUCTION_NODE</td> <td>7</td> <td>一个用于 XML 文档的 ProcessingInstruction ，例如 &lt;?xml-stylesheet ... ?&gt; 声明。</td></tr> <tr><td>Node.COMMENT_NODE</td> <td>8</td> <td>一个 Comment 节点。</td></tr> <tr><td>Node.DOCUMENT_NODE</td> <td>9</td> <td>一个 Document 节点。</td></tr> <tr><td>Node.DOCUMENT_TYPE_NODE</td> <td>10</td> <td>描述文档类型的 DocumentType 节点。例如 &lt;!DOCTYPE html&gt; 就是用于 HTML5 的。</td></tr> <tr><td>Node.DOCUMENT_FRAGMENT_NODE</td> <td>11</td> <td>一个 DocumentFragment 节点</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>已弃用的节点类型常量</p> <table><thead><tr><th>常量</th> <th>值</th> <th>描述</th></tr></thead> <tbody><tr><td>Node.ATTRIBUTE_NODE</td> <td>2</td> <td>元素 的耦合属性 。在 DOM4 规范里 Node 接口将不再实现这个元素属性。</td></tr> <tr><td>Node.ENTITY_REFERENCE_NODE</td> <td>5</td> <td>一个 XML 实体引用节点。 在 DOM4 规范里被移除。</td></tr> <tr><td>Node.ENTITY_NODE</td> <td>6</td> <td>一个 XML &lt;!ENTITY ...&gt; 节点。 在 DOM4 规范中被移除。</td></tr> <tr><td>Node.NOTATION_NODE</td> <td>12</td> <td>一个 XML &lt;!NOTATION ...&gt; 节点。 在 DOM4 规范里被移除.</td></tr></tbody></table></div> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @author Wuner
 * @date 2020/7/30 2:52
 * @description
 */</span>
<span class="token comment">// 负责解析指令/插值表达式</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compiler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 编译模板，处理文本节点和元素节点</span>
  <span class="token function">compiler</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// el.childNodes是一个伪数组</span>
    <span class="token keyword">const</span> childNodes <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    childNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.dir(node);</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理文本节点</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compilerText</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isElementNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理元素节点</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compilerElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 判断当前节点是否存在子节点，并且子节点个数大于0，需递归调用compile</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compiler</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 编译元素节点，处理指令</span>
  <span class="token function">compilerElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.dir(node);</span>
    <span class="token comment">// attributes是一个伪数组</span>
    <span class="token comment">// 遍历元素节点中的所有属性，找到指令</span>
    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取元素属性的名称</span>
      <span class="token comment">// 判断当前的属性名称是否是指令</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirective</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updater</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 负责更新 DOM</span>
  <span class="token comment">// 创建 Watcher</span>
  <span class="token function">updater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// attrName 的形式 v-text v-model</span>
    <span class="token comment">// 截取属性的名称，获取 text model</span>
    <span class="token keyword">const</span> attrName <span class="token operator">=</span> attr<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理不同的指令</span>
    <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>attrName <span class="token operator">+</span> <span class="token string">'Updater'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 因为在 textUpdater等中要使用 this</span>
    fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> attr<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 处理 v-text 指令</span>
  <span class="token function">textUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 每一个指令中创建一个 watcher，观察数据的变化</span>
    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 处理 v-model 指令</span>
  <span class="token function">modelUpdater</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 监听视图的变化</span>
    node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 每一个指令中创建一个 watcher，观察数据的变化</span>
    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 编译文本节点</span>
  <span class="token function">compilerText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.dir(node);</span>
    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex">/\{\{(.+?)\}\}/</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取文本节点的内容</span>
    <span class="token keyword">let</span> textContent <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>textContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 插值表达式中的值就是我们要的属性名称</span>
      <span class="token keyword">let</span> key <span class="token operator">=</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 把插值表达式替换成具体的值</span>
      node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 判断是否属性是指令</span>
  <span class="token function">isDirective</span><span class="token punctuation">(</span><span class="token parameter">attrName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> attrName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'v-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 判断是否是文本节点</span>
  <span class="token function">isTextNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 判断是否是元素节点</span>
  <span class="token function">isElementNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br></div></div><h3 id="dep-dependency"><a href="#dep-dependency" class="header-anchor">#</a> Dep(Dependency)</h3> <p><img src="/wuner-notes/assets/img/6.a119ed87.png" alt="note"></p> <ul><li>收集依赖，添加观察者(watcher)</li> <li>通知所有观察者</li></ul> <p><img src="/wuner-notes/assets/img/7.3375f788.png" alt="note"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @author Wuner
 * @date 2020/7/30 22:00
 * @description
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 存储观察者的数组</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 添加观察者</span>
  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断是否是观察者</span>
    sub <span class="token operator">&amp;&amp;</span> sub<span class="token punctuation">.</span>update <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 通知所有观察者</span>
  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="watcher"><a href="#watcher" class="header-anchor">#</a> Watcher</h3> <p><img src="/wuner-notes/assets/img/8.a6240b07.png" alt="note"></p> <ul><li>当数据变化触发依赖， dep 通知所有的 Watcher 实例更新视图</li> <li>自身实例化的时候往 dep 对象中添加自己</li></ul> <p><img src="/wuner-notes/assets/img/9.648168a8.png" alt="note"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @author Wuner
 * @date 2020/7/30 22:17
 * @description
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token comment">// 当数据变化的时候，调用 callback 更新视图</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callback <span class="token operator">=</span> callback<span class="token punctuation">;</span>

    <span class="token comment">// 在 Dep 的静态属性上记录当前 watcher 对象，当访问数据的时候把 watcher 添加到 dep 的 subs 中</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里通过vm取值时，会调用到observer中的defineReactive中的get方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>oldValue <span class="token operator">=</span> vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 赋值后，将缓存清空，防止污染</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>oldValue <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h2> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <ul><li><p>给属性重新赋值成对象，是否是响应式的？</p> <p>是响应式</p></li> <li><p>给 Vue 实例新增一个成员是否是响应式的？</p> <p>不是响应式的。<a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener noreferrer">原因<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h3 id="整体流程"><a href="#整体流程" class="header-anchor">#</a> 整体流程</h3> <p><img src="/wuner-notes/assets/img/10.c0f4b513.png" alt="note"></p> <ul><li>Vue
<ul><li>记录传入的选项，设置 $data/$el</li> <li>把 data 的成员注入到 Vue 实例</li> <li>负责调用 Observer 实现数据响应式处理（数据劫持）</li> <li>负责调用 Compiler 编译指令/插值表达式等</li></ul></li> <li>Observer
<ul><li>数据劫持</li> <li>负责把 data 中的成员转换成 getter/setter</li> <li>负责把多层属性转换成 getter/setter</li> <li>如果给属性赋值为新对象，把新对象的成员设置为 getter/setter</li> <li>添加 Dep 和 Watcher 的依赖关系</li> <li>数据变化发送通知</li></ul></li> <li>Compiler
<ul><li>负责编译模板，解析指令/插值表达式</li> <li>负责页面的首次渲染过程</li> <li>当数据变化后重新渲染</li></ul></li> <li>Dep
<ul><li>收集依赖，添加订阅者(watcher)</li> <li>通知所有订阅者</li></ul></li> <li>Watcher
<ul><li>自身实例化的时候往 dep 对象中添加自己</li> <li>当数据变化 dep 通知所有的 Watcher 实例更新视图</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wuner-notes/fed-e-task-03-01/notes/w-001-vue-router/w-002-simulation-vue-router/" class="prev">
        模拟 VueRouter
      </a></span> <span class="next"><a href="/wuner-notes/fed-e-task-03-01/notes/w-003-virtual-dom/w-001-snabbdom/">
        Snabbdom
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
<script src="/wuner-notes/assets/js/app.a809ef8d.js" defer></script><script src="/wuner-notes/assets/js/3.aefe3dc3.js" defer></script><script src="/wuner-notes/assets/js/5.499729e8.js" defer></script>
</body>
</html>
